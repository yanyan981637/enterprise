{"version":3,"sources":["../../ts/src/in-page/SidebarView.ts"],"names":["SidebarView","props","setBuckets","indexes","indexIdentifier","buckets","activeBuckets","each","idx","identifier","bucket","bucketItems","activeBucketItems","item","state","filterList","has","code","get","indexOf","key","push","isActive","select","selectItem","length","map","filters","splice","set","delete","observableArray","result","activeIndex","document","click","e","target","closest","toggleClass","subscribe","index"],"mappings":"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","sourcesContent":["import { Bucket, BucketItem, IndexResult, Result } from \"../types\"\nimport _ from \"underscore\"\nimport ko from \"knockout\"\nimport $ from \"jquery\"\n\ninterface Props {\n    result: KnockoutObservable<Result>\n    activeIndex: KnockoutObservable<string>\n    filterList: KnockoutObservable<Map<string, string>>\n}\n\ninterface SelectableBucketItem extends BucketItem {\n    select: () => void\n    isActive: boolean\n}\n\ninterface SelectableBucket {\n    code: string\n    label: string\n    buckets: SelectableBucketItem[]\n    activeBuckets: SelectableBucketItem[]\n}\n\nexport class SidebarView {\n    props: Props\n\n    buckets: KnockoutObservableArray<SelectableBucket>\n    activeBuckets: KnockoutObservableArray<SelectableBucket>\n\n    constructor(props: Props) {\n        this.props = props\n        this.buckets = ko.observableArray([])\n        this.activeBuckets = ko.observableArray([])\n\n        this.setBuckets(props.result().indexes, props.activeIndex())\n        $(document).click(\".mstInPage__bucket .filter-options-title\", e => {\n            $(e.target).closest(\".mstInPage__bucket\"). toggleClass(\"active\")\n        });\n\n        props.result.subscribe(result => this.setBuckets(result.indexes, props.activeIndex()))\n        props.activeIndex.subscribe(index => this.setBuckets(props.result().indexes, index))\n    }\n\n    setBuckets = (indexes: IndexResult[], indexIdentifier: string) => {\n        let buckets: SelectableBucket[] = []\n        let activeBuckets: SelectableBucket[] = []\n\n        _.each(indexes, idx => {\n            if (idx.identifier != indexIdentifier) {\n                return\n            }\n\n            _.each(idx.buckets, bucket => {\n                let bucketItems = [],\n                    activeBucketItems = []\n\n                _.each(bucket.buckets, item => {\n                    let state = this.props.filterList().has(bucket.code) && this.props.filterList().get(bucket.code).indexOf(item.key) >=0\n\n                    if (state) {\n                        activeBucketItems.push({\n                            ...item,\n                            isActive: state,\n                            select:   () => this.selectItem(bucket, item),\n                        })\n                    }\n\n                    bucketItems.push({\n                        ...item,\n                        isActive: state,\n                        select:   () => this.selectItem(bucket, item),\n                    })\n                })\n\n                if (bucketItems.length > 0) {\n                    buckets.push({\n                        ...bucket,\n                        buckets: bucketItems,\n                    })\n                }\n\n                if (activeBucketItems.length > 0) {\n                    activeBuckets.push({\n                        ...bucket,\n                        buckets: activeBucketItems,\n                    })\n                }\n            })\n        })\n\n        this.buckets(buckets)\n        this.activeBuckets(activeBuckets)\n    }\n\n    selectItem = (bucket: Bucket, item: BucketItem) => {\n        const map = this.props.filterList()\n\n        if (map.has(bucket.code)) {\n            let filters = map.get(bucket.code)\n            if (map.get(bucket.code).indexOf(item.key) >= 0) {\n                filters.splice([map.get(bucket.code).indexOf(item.key)], 1)\n                if (filters.length > 0) {\n                    map.set(bucket.code, filters)\n                } else {\n                    map.delete(bucket.code)\n                }\n            } else {\n                filters.push(item.key);\n                map.set(bucket.code, filters)\n            }\n        } else {\n            map.set(bucket.code, [item.key])\n        }\n\n        this.props.filterList(map)\n    }\n}\n"],"file":"SidebarView.js"}