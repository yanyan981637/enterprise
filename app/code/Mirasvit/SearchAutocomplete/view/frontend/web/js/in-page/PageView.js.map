{"version":3,"sources":["../../ts/src/in-page/PageView.ts"],"names":["EMPTY_RESULT","indexes","noResults","query","textAll","textEmpty","totalItems","urlAll","PageView","config","isEmpty","searchQuery","time","hide","visible","request","xhr","abort","result","ts","Date","getTime","loading","filters","filterList","subscribe","page","forEach","value","key","clear","ajax","url","dataType","type","data","q","store_id","storeId","cat","limit","p","index","activeIndex","buckets","currency","success","observable","Map","sendRequest","debounce","searchBarView","SearchBarView","indexListView","IndexListView","itemListView","ItemListView","sidebarView","SidebarView","pagingView","PagingView","toggleClass","document","on","e"],"mappings":"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","sourcesContent":["import { Config, Result } from \"../types\"\nimport _ from \"underscore\"\nimport ko from \"knockout\"\nimport $ from \"jquery\"\nimport { IndexListView } from \"./IndexListView\"\nimport { SearchBarView } from \"./SearchBarView\"\nimport { ItemListView } from \"./ItemListView\"\nimport { SidebarView } from \"./SidebarView\"\nimport { PagingView } from \"./PagingView\";\n\nconst EMPTY_RESULT = {\n    indexes:    [],\n    noResults:  false,\n    query:      \"\",\n    textAll:    \"\",\n    textEmpty:  \"\",\n    totalItems: 0,\n    urlAll:     \"\",\n}\n\nexport class PageView {\n    visible: KnockoutObservable<boolean>\n    loading: KnockoutObservable<boolean>\n    sendRequest: () => void\n    xhr: JQueryXHR | null\n    config: Config\n    page: KnockoutObservable<number>\n    result: KnockoutObservable<Result>\n    time: KnockoutObservable<number>\n\n    activeIndex: KnockoutObservable<string>\n    searchQuery: KnockoutObservable<string>\n    filterList: KnockoutObservable<Map<string, string>>\n\n    searchBarView: SearchBarView\n    indexListView: IndexListView\n    itemListView: ItemListView\n    sidebarView: SidebarView\n    pagingView: PagingView\n\n    constructor(config: Config) {\n        this.config = config\n        this.page = ko.observable(1)\n        this.visible = ko.observable(false)\n        this.loading = ko.observable(false)\n        this.searchQuery = ko.observable(\"\")\n        this.activeIndex = ko.observable(\"magento_catalog_product\")\n        this.filterList = ko.observable(new Map<string, string>())\n        this.sendRequest = _.debounce(this.request, 10)\n        this.xhr = null\n        this.result = ko.observable(EMPTY_RESULT)\n        this.time = ko.observable(0)\n\n        this.searchBarView = new SearchBarView({\n            query:   this.searchQuery,\n            visible: this.visible,\n        })\n\n        this.indexListView = new IndexListView({\n            result:      this.result,\n            activeIndex: this.activeIndex,\n        })\n\n        this.itemListView = new ItemListView({\n            result:      this.result,\n            activeIndex: this.activeIndex,\n        })\n\n        this.sidebarView = new SidebarView({\n            result:      this.result,\n            activeIndex: this.activeIndex,\n            filterList:  this.filterList,\n        })\n\n        this.pagingView = new PagingView({\n            result:      this.result,\n            activeIndex: this.activeIndex,\n            page:        this.page,\n        })\n\n        this.visible.subscribe(visible => {\n            $(\"html\").toggleClass(\"mstInPage\", visible)\n        })\n\n        $(document).on(\"keyup\", e => {\n            if (e.key === \"Escape\") {\n                this.searchQuery() == \"\" && this.visible(false)\n            }\n        })\n\n        this.searchQuery.subscribe(this.sendRequest)\n        this.filterList.subscribe(this.sendRequest)\n        this.page.subscribe(this.sendRequest)\n    }\n\n    isEmpty = () => {\n        return this.searchQuery() === \"\" || this.time() === 0\n    }\n\n    hide = () => {\n        this.visible(false)\n    }\n\n    request = () => {\n        this.xhr?.abort()\n\n        if (this.searchQuery() === \"\") {\n            this.result(EMPTY_RESULT)\n            this.time(0)\n\n            return\n        }\n\n        const ts = new Date().getTime()\n\n        this.loading(true)\n        let filters: any = {}\n\n        this.filterList.subscribe(() => {\n            this.page(1)\n        })\n\n        if (this.result().query == this.searchQuery()) {\n            this.filterList().forEach((value, key) => filters[key] = value)\n        } else {\n            this.page(1)\n            this.filterList().clear()\n            filters = {}\n        }\n\n        this.xhr = $.ajax({\n            url:      this.config.url,\n            dataType: \"json\",\n            type:     \"GET\",\n            data:     {\n                q:        this.searchQuery(),\n                store_id: this.config.storeId,\n                cat:      false,\n                limit:    this.config.limit,\n                p:        this.page,\n                index:    this.activeIndex,\n                buckets:  [ \"category_ids\" ],\n                filters:  filters,\n                currency: this.config.currency,\n            },\n            success:  (data: Result) => {\n                this.loading(false)\n                this.result(data)\n                this.time((new Date().getTime() - ts) / 1000)\n            },\n        })\n    }\n}\n"],"file":"PageView.js"}